<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Escala 3x3 Autom√°tica</title>

  <!-- PWA / Apple -->
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Escala 3x3">
  <link rel="apple-touch-icon" href="icon.png">

  <style>
    body { font-family: Arial, sans-serif; margin: 10px; }
    h1 { font-size: 1.4em; text-align: center; }

    .controls {
      display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px; justify-content: center;
    }
    .controls label { font-size: 0.9em; }
    .controls input, .controls select, .controls button { padding: 6px; font-size: 0.9em; }

    table { border-collapse: collapse; width: 100%; margin-top: 10px; font-size: 0.85em; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background-color: #f5f5f5; }

    #resultado { margin-top: 10px; font-weight: bold; text-align: center; }

    /* Cores da escala */
    .work { background: #fff9e6; }   /* trabalho */
    .off  { background: #eaffea; }   /* folga  */
    .highlight { background: #ffff99 !important; } /* folga em s√°bado/domingo */
    .past { color: #888; text-decoration: line-through; }
    .today { background: #99ccff !important; font-weight: bold; }

    /* Etiquetas de feriado/ponto facultativo no "Dia da semana" */
    td.dow-holiday-nac { color: #c51616; font-weight: bold; }               /* nacional */
    td.dow-holiday-mun { color: #7c1133; font-weight: bold; }               /* municipal (vinho) */
    td.dow-facultativo { color: #555; font-weight: bold; }                  /* ponto facultativo (cinza escuro) */

    .badge {
      font-size: 0.68em; margin-left: 6px; vertical-align: middle; opacity: 0.95;
      font-weight: normal; border-radius: 10px; padding: 1px 6px; border: 1px solid transparent;
    }
    .badge-nac { color: #c51616; border-color: #f1c1c1; background: #fff5f5; }
    .badge-mun { color: #7c1133; border-color: #e0b7c6; background: #fff6f9; }
    .badge-pf  { color: #555;     border-color: #d7d7d7; background: #fafafa; }

    /* Se o dia j√° passou, mant√©m o risco mas preserva a cor da c√©lula */
    tr.past td.dow-holiday-nac,
    tr.past td.dow-holiday-mun,
    tr.past td.dow-facultativo { text-decoration: line-through; }

    /* Responsivo */
    @media (max-width: 600px) {
      table, thead, tbody, th, td, tr { display: block; }
      thead tr { display: none; }
      tr { margin-bottom: 10px; border: 1px solid #ccc; padding: 6px; border-radius: 6px; }
      td { border: none; text-align: left; padding: 4px; }
      td::before { font-weight: bold; display: inline-block; width: 120px; }
      td:nth-child(1)::before { content: "Data: "; }
      td:nth-child(2)::before { content: "Dia da semana: "; }
      td:nth-child(3)::before { content: "Status: "; }
      td:nth-child(4)::before { content: "Sim/N√£o: "; }
    }
  </style>
</head>
<body>
  <h1>Escala de Trabalho/Folga 3x3</h1>

  <div class="controls">
    <label for="ano"><strong>Ano:</strong></label>
    <select id="ano" onchange="atualizarTabela()">
      <option value="2025">2025</option>
      <option value="2026" selected>2026</option>
      <option value="2027">2027</option>
      <option value="2028">2028</option>
    </select>

    <label for="pesquisa"><strong>Pesquisar:</strong></label>
    <input type="text" id="pesquisa" placeholder="dd/mm/aaaa">
    <button onclick="pesquisar()">Buscar</button>
  </div>

  <div id="resultado"></div>

  <table id="agenda">
    <thead>
      <tr>
        <th>Data</th>
        <th>Dia da semana</th>
        <th>Trabalho/Folga</th>
        <th>Sim/N√£o</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // === BASE DA ROTA√á√ÉO 3x3 ===
    const BASE_INICIO = new Date(2025, 10, 22); // 22/11/2025

    // === Utils ===
    function formatarData(d) {
      const dia = String(d.getDate()).padStart(2, '0');
      const mes = String(d.getMonth() + 1).padStart(2, '0');
      const ano = d.getFullYear();
      return `${dia}/${mes}/${ano}`;
    }
    function diaSemanaLabel(idx) {
      const nomes = ["Domingo","Segunda-feira","Ter√ßa-feira","Quarta-feira","Quinta-feira","Sexta-feira","S√°bado"];
      return nomes[idx];
    }
    function addDias(d, n) { const x = new Date(d); x.setDate(x.getDate() + n); return x; }
    function mesmaData(d1, d2) {
      return d1.getFullYear() === d2.getFullYear() &&
             d1.getMonth() === d2.getMonth() &&
             d1.getDate() === d2.getDate();
    }

    // === C√°lculo da P√°scoa (gregoriano) ===
    function pascoaDomingo(ano) {
      const a = ano % 19;
      const b = Math.floor(ano / 100);
      const c = ano % 100;
      const d = Math.floor(b / 4);
      const e = b % 4;
      const f = Math.floor((b + 8) / 25);
      const g = Math.floor((b - f + 1) / 3);
      const h = (19*a + b - d - g + 15) % 30;
      const i = Math.floor(c / 4);
      const k = c % 4;
      const l = (32 + 2*e + 2*i - h - k) % 7;
      const m = Math.floor((a + 11*h + 22*l) / 451);
      const mes = Math.floor((h + l - 7*m + 114) / 31); // 3=Mar, 4=Abr
      const dia = ((h + l - 7*m + 114) % 31) + 1;
      return new Date(ano, mes - 1, dia);
    }

    // === Regras rota√ß√£o 3x3 ===
    function statusPorRotacao(data) {
      const msPorDia = 24 * 60 * 60 * 1000;
      const diffDias = Math.floor((data - BASE_INICIO) / msPorDia);
      const mod6 = ((diffDias % 6) + 6) % 6;
      return mod6 <= 2 ? "Trabalho" : "Folga";
    }
    function simOuNao(data) {
      const dw = data.getDay();
      return (dw === 0 || dw === 6) ? "Sim" : "N√£o";
    }

    // === Feridos nacionais (fixos + Sexta-Feira Santa) ===
    function feriadoNacionalInfo(data) {
      const mapaFixos = {
        "0-1":  "Confraterniza√ß√£o Universal",
        "3-21": "Tiradentes",
        "4-1":  "Dia do Trabalhador",
        "8-7":  "Independ√™ncia do Brasil",
        "9-12": "Nossa Senhora Aparecida",
        "10-2": "Finados",
        "10-15":"Proclama√ß√£o da Rep√∫blica",
        "10-20":"Consci√™ncia Negra",
        "11-25":"Natal"
      };
      const chave = `${data.getMonth()}-${data.getDate()}`;
      if (mapaFixos[chave]) return { is: true, name: mapaFixos[chave], scope: "nac" };

      const pascoa = pascoaDomingo(data.getFullYear());
      const sextaSanta = addDias(pascoa, -2);
      if (mesmaData(data, sextaSanta)) return { is: true, name: "Paix√£o de Cristo", scope: "nac" };

      return { is: false };
    }

    // === Pontos facultativos (Portaria federal 2026) ===
    // Obs.: usados como refer√™ncia visual apenas; n√£o s√£o feriado nacional.
    function pontoFacultativoInfo(data) {
      const y = data.getFullYear();
      // Carnaval (seg/ter) e Quarta de Cinzas (at√© 14h)
      // Em 2026: 16 (seg), 17 (ter), 18 (qua at√© 14h)
      const pf2026 = [
        "1-16", "1-17", "1-18", // fev
        "3-20",                // 20/abr (v√©spera de Tiradentes)
        "5-4",  "5-5",         // 4/6 Corpus Christi (qui) e 5/6 (sex)
        "11-24", "11-31"       // 24/12 e 31/12 (ap√≥s 13h)
      ];
      // Se quiser compatibilizar outros anos, voc√™ pode expandir uma tabela por ano aqui.
      const chave = `${data.getMonth()}-${data.getDate()}`;
      if (y === 2026 && pf2026.includes(chave)) {
        let name = "";
        if (chave === "1-16") name = "Carnaval (ponto facultativo)";
        else if (chave === "1-17") name = "Carnaval (ponto facultativo)";
        else if (chave === "1-18") name = "Quarta-feira de Cinzas (at√© 14h)";
        else if (chave === "3-20") name = "V√©spera de Tiradentes (ponto facultativo)";
        else if (chave === "5-4")  name = "Corpus Christi (ponto facultativo)";
        else if (chave === "5-5")  name = "Ponto facultativo";
        else if (chave === "11-24") name = "V√©spera de Natal (ponto facultativo)";
        else if (chave === "11-31") name = "V√©spera de Ano-Novo (ponto facultativo)";
        return { is: true, name };
      }
      return { is: false };
    }

    // === Feriados municipais ‚Äì Nova Lima/MG ===
    function feriadoMunicipalInfo(data) {
      // 15/08 e 08/12
      const chave = `${data.getMonth()}-${data.getDate()}`;
      const mapa = {
        "7-15":  "Assun√ß√£o de Nossa Senhora (Municipal)",
        "11-8":  "Imaculada Concei√ß√£o (Municipal)"
      };
      if (mapa[chave]) return { is: true, name: mapa[chave], scope: "mun" };
      return { is: false };
    }

    function marcadorDeDia(data) {
      // Prioridade: Feriado nacional > Feriado municipal > Ponto facultativo
      const infoN = feriadoNacionalInfo(data);
      if (infoN.is) return { className: "dow-holiday-nac", badgeClass: "badge badge-nac", badgeText: "feriado (nacional)", title: infoN.name };

      const infoM = feriadoMunicipalInfo(data);
      if (infoM.is) return { className: "dow-holiday-mun", badgeClass: "badge badge-mun", badgeText: "feriado (municipal)", title: infoM.name };

      const infoPF = pontoFacultativoInfo(data);
      if (infoPF.is) return { className: "dow-facultativo", badgeClass: "badge badge-pf", badgeText: "ponto facultativo", title: infoPF.name };

      return null;
    }

    function gerarTabela(ano) {
      const tbody = document.querySelector("#agenda tbody");
      tbody.innerHTML = "";

      for (let mes = 0; mes < 12; mes++) {
        const ultimoDia = new Date(ano, mes + 1, 0).getDate();
        for (let dia = 1; dia <= ultimoDia; dia++) {
          const data = new Date(ano, mes, dia);

          const dataFmt = formatarData(data);
          const labelSemana = diaSemanaLabel(data.getDay());
          const status = statusPorRotacao(data);
          const simnao = simOuNao(data);

          let classe = status === "Trabalho" ? "work" : "off";
          if (status === "Folga" && simnao === "Sim") classe = "highlight";

          const mark = marcadorDeDia(data);
          const dowClass = mark ? mark.className : "";
          const dowHTML  = mark
            ? `${labelSemana} <span class="${mark.badgeClass}" title="${mark.title}">${mark.badgeText}</span>`
            : labelSemana;

          const tr = document.createElement("tr");
          tr.className = classe;
          tr.innerHTML = `
            <td>${dataFmt}</td>
            <td class="${dowClass}">${dowHTML}</td>
            <td>${status}</td>
            <td>${simnao}</td>
          `;
          tbody.appendChild(tr);
        }
      }
    }

    function marcarDiasPassados() {
      const hoje = new Date();
      hoje.setHours(0,0,0,0);
      const linhas = document.querySelectorAll("#agenda tbody tr");
      let linhaHoje = null;

      linhas.forEach(linha => {
        const dataTexto = linha.cells[0].textContent;
        const [dia, mes, ano] = dataTexto.split("/");
        const dataLinha = new Date(ano, mes - 1, dia);
        dataLinha.setHours(0,0,0,0);

        if (dataLinha < hoje) {
          linha.classList.add("past");
        } else if (dataLinha.getTime() === hoje.getTime()) {
          linha.classList.add("today");
          linha.cells[2].textContent += " (Dia atual)";
          linhaHoje = linha;
        }
      });

      if (linhaHoje) {
        linhaHoje.scrollIntoView({ behavior: "smooth", block: "center" });
      }
    }

    function atualizarTabela() {
      const anoSelecionado = parseInt(document.getElementById("ano").value, 10);
      gerarTabela(anoSelecionado);
      marcarDiasPassados();
      document.getElementById("resultado").textContent = "";
    }

    function pesquisar() {
      const input = document.getElementById("pesquisa").value.trim();
      const linhas = document.querySelectorAll("#agenda tbody tr");
      let encontrado = false;

      for (const linha of linhas) {
        const data = linha.cells[0].textContent;
        if (data === input) {
          const dia = linha.cells[1].textContent;
          const status = linha.cells[2].textContent;
          const simnao = linha.cells[3].textContent;

          // Indica se √© feriado ou ponto facultativo no resultado
          const [dd, mm, aaaa] = data.split("/");
          const d = new Date(parseInt(aaaa), parseInt(mm)-1, parseInt(dd));
          const m = marcadorDeDia(d);
          const extra = m ? (m.badgeText.includes("feriado") ? ` ‚Äî FERIADO: ${m.title}` : ` ‚Äî ${m.title}`) : "";

          document.getElementById("resultado").textContent =
            `üìÖ ${data} (${dia}) ‚Üí ${status}, Sim/N√£o: ${simnao}${extra}`;
          encontrado = true;
          break;
        }
      }

      if (!encontrado) {
        document.getElementById("resultado").textContent = "Data n√£o encontrada na tabela do ano atual.";
      }
    }

    function inicializarAno() {
      const hoje = new Date();
      const anoAtual = hoje.getFullYear();
      const seletor = document.getElementById("ano");

      if (anoAtual > 2025) {
        for (let i = 0; i < seletor.options.length; i++) {
          if (seletor.options[i].value === "2025") { seletor.remove(i); break; }
        }
        seletor.value = String(anoAtual);
      } else {
        seletor.value = "2025";
      }
      atualizarTabela();
    }

    document.addEventListener("DOMContentLoaded", inicializarAno);
  </script>
</body>
</html>
``
